<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
</head>
<body>
    <h1>User Profile</h1>
    <div id="userInfo"></div>

    <button onclick="goToChatVoice()">Chat/Voice</button>

    <script>
        // Client-side session object to hold user data
        const session = {
            user: null,
            isAuthenticated: false
        };

        // Initialize the session and render the page
        function init() {
            const urlParams = new URLSearchParams(window.location.search);
            const userDataStr = urlParams.get('userData');

            if (userDataStr) {
                try {
                    const userData = JSON.parse(userDataStr);
                    if (userData && userData._id) {
                        session.user = userData;
                        session.isAuthenticated = true;
                        renderProfile();
                    } else {
                        throw new Error("Invalid user data");
                    }
                } catch (e) {
                    alert("Failed to parse user data from URL");
                    window.location.href = 'index.html';
                }
            } else {
                // If no user data, redirect to login
                window.location.href = 'index.html';
            }
        }

        // Render the user profile information
        function renderProfile() {
            if (!session.isAuthenticated) return;

            const userInfoDiv = document.getElementById('userInfo');
            let userInfoHtml = '<ul>';
            for (const key in session.user) {
                userInfoHtml += `<li><strong>${key}:</strong> ${session.user[key]}</li>`;
            }
            userInfoHtml += '</ul>';
            userInfoDiv.innerHTML = userInfoHtml;
        }

        // Navigate to the chat/voice page
        function goToChatVoice() {
            if (session.isAuthenticated && session.user._id) {
                window.location.href = `chat_voice.html?user_id=${session.user._id}`;
            } else {
                alert("Could not find user ID. Please log in again.");
            }
        }

        // Initialize the page on DOMContentLoaded event
        document.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>